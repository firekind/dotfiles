#!/usr/bin/env python3

import os
import math
import argparse
import subprocess

parser = argparse.ArgumentParser("brightness")
parser.add_argument("op", choices=["inc", "dec"], help="increment or decrement")
parser.add_argument("amount", type=int, help="amount to increment or decrement (0-100)")

args = parser.parse_args()

dir_path = "/sys/class/backlight/intel_backlight"

# getting max brightness (usually some huge ass value)
with open(os.path.join(dir_path, "max_brightness"), "r") as f:
    max_brightness = int(f.read())

# getting current brightness
with open(os.path.join(dir_path, "brightness"), "r") as f:
    current_brightness = int(f.read())

# converting current brightness into percentage
current_percentage = current_brightness / max_brightness

# incrementing or decrementing 
if args.op == "inc":
    new_brightness_percentage = min(current_percentage + (args.amount / 100), 1)
else:
    new_brightness_percentage = max(current_percentage - (args.amount / 100), 0)

# converting the percentage into an integer value
new_brightness = int(new_brightness_percentage * max_brightness)

# writing new brightness
with open(os.path.join(dir_path, "brightness"), "w") as f:
    f.write(str(new_brightness))

# sending notification
subprocess.run([
    "dunstify", 
    "Brightness: %s%%" % math.ceil(new_brightness_percentage * 100), 
    "-r", 
    "-10"
])

